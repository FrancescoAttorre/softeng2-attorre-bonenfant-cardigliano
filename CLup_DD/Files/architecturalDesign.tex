%Product Perspective
\subsection{Overview: High-level components and their interaction}

\subsection{Component view}
\begin{figure}[H]
	\centering
	\includegraphics[width=1\textwidth]{/Diagrams/ComponentDiagram}
	\caption{Component Diagram}
\end{figure}



\textbf{TicketManager}\\
This component provides services to deliver new tickets, change their state and communicates with BuildingManager to associate them with a Building.\\


\textbf{AuthManager}\\
This component offers services to authenticate users and deliver them tokens that authorize to use the other services. The dispatcher component will ask the Auth Manager to check the token validity before forwarding requests to other Components.\\

\textbf{BuildingManager}\\
Provides services to add buildings to the system, track the number of people in specific buildings, append and pop line up tickets from queues and add booking tickets to a building.\\

\textbf{RegistrationService}\\
Allows UnregisteredAppCustomers and Activities to register to CLup through its service.\\

\textbf{GoogleMapsService}\\
External service component that provides web mapping. Used to locate Buildings nearby.\\

\textbf{Dispatcher}\\
This component manages the requests received from MobileApp and Web Server components and redirects each one to the correct component able to handle it.\\

\textbf{Mobile Application}\\
Acts as a Client sending requests to the Dispatcher component.
It it a fat client since it does contain Applicative logic.\\

\textbf{Web Application}\\
Web Client sending requests to the Dispatcher like the Mobile Application. It will be thinner than the Mobile Application taking part only at the Presentation Level since it does not contain any Applicative logic.\\

\textbf{DataManager}\\
Manages datastructures and objects to persist to the database.\\

\textbf{DBMS Service}\\
Represents the DBMS and the service he offers. It communicats with the DataManager\\

\textbf{GPS Service}\\
Positioning system used to locate a device.\\

\textbf{MapsServiceMobileAdapter}\\
Adapter that offers to the MobileApplication component an interface for using Mapping services. Useful if the external Mapping service changes the Mobile Application will always used the same interface.\\

\textbf{MapsServiceServerAdapter}\\
Like previous adapter but for the BuildingManager component. Having 2 different Adapters offers the possibility to use different Mapping services for MobileApplication and BuildingManager 


\subsection{Deployment view}

\subsection{Runtime view}
Here are proposed sequence diagrams in order to describe the way components interact with each other to accomplish specific tasks (the ones shown in the use cases of the RASD document).\\

\begin{center} 
Premise\\
\end{center}
Itâ€™s not explicitly stated in every sequence diagram that a token checking is performed for every request done from the Client to the Server. In order to do this, the dispatcher before processing the request just received will perform on AuthServer a token validity check. Instead the identification action performed in some diagrams has the task to retrieve the User information.\\

\newpage
\textbf{Authentication Sequence Diagram\\}
\textit{Two different authentication procedures can occur, the first is an authentication on a RegisteredAppCustomer account, instead a daily access to CLup services can be requested by UnregisteredAppCustomer.\\}
\textbf{Description\\}
Both of the following process lead to gaining a token, that is a temporary access key for Server functionalities. The second one is Daily in the sense that every operation on server would stay for at most one day.
account based - an authentication request is made by the client, after correctly forwarding this request to AuthManager an account check is done. If the user exists and has no token already associated with its account, then a new one will be created. Client receives a response containing his token. 
daily - a daily authentication request is made by the client, after correctly forwarding this request to AuthManager an access check is done. If the client can get a token in order to access server basic functions a new association between a specific client and a new token is made, else a negative response is sent back to the client. \\

\begin{figure}[H]
 \centering
 \includegraphics[width=\textwidth]{Authentication (registered) Sequence Diagram}
 \caption{ Authentication (registered) Sequence Diagram}
 \end{figure}

\begin{figure}[H]
 \centering
 \includegraphics[width=\textwidth]{Authentication (daily) Sequence Diagram}
 \caption{Authentication (daily) Sequence Diagram}
 \end{figure}

\newpage
\textbf{ Acquire a LineUpDigitalTicket Sequence Diagram\\}
\textit{This diagram explains how a LineUpDigitalTicket cou be acquired by an AppCustomer.\\}
\textbf{Description\\}
Client retrieves its position and sends a request in order to receive a list of buildings from which one would be selected. Building retrieval is effectively done by the DataManager. Whereas the MapsServiceAdapter (communication with a maps API) provide useful information to correctly pick only reachable buildings.
Once the building is selected, Client sends another request in order to gain a ticket. An identification is performed on AuthManager to correctly retrieve the UserID (associated to the token) needed in ticket acquisition. Afterwards, to complete the process,if the building has at least one void space the ticket state is setted to Valid,else the ticket is inserted in the queue.
Note that only after a Discovery request from the client, this ticket will produce a notification (as described in next diagram).\\

\begin{figure}[H]
 \centering
 \includegraphics[width=\textwidth]{Acquire a LineUpDigitalTicket Sequence Diagram}
 \caption{ Acquire a LineUpDigitalTicket Sequence Diagram}
 \end{figure}



\subsubsection{oneSubsectionPerAction}

\subsection{Component Interfaces}
The following diagram shows all the component interfaces already exploited in the sequence diagrams together with the dependencies between the various components. 

\subsection{Selected architectural styles and patterns}
The architectural style selected is a three-tier client-server architecture, in order to have a good decoupling of logic, data and presentation, increasing reusability, flexibility and scalability. Moreover, components in the application server have to be developed with low coupling among modules in order to make the system more comprehensible and maintainable. About the components, they have been designed to maintain a stateless logic as much as possible, that is, they should not contain an internal state, but refer to the database to get the necessary information about the system. This is important since instances of components can fail, go down and nothing must go lost in this eventuality. In this context the scalability of the database is so important, and DataAccessManager will play a leading role. 
The protocol used to send requests is HTTP, which is a good choice to implement a RESTful architecture to meet the above objectives of having a stateless and low coupling system. Other advantages are that it would be cacheable and with a uniform interface.
Data are transmitted in JSON, which is one of the simplest and most easily customizable protocols. It is also easy readable and allows fast parsing.\\

Finally, we've decided to use some design patterns in order to exploit existing models to solve recurrent problems. This benefits the reusability and maintainability of the code, as well as making it easier for designers to understand how the system works. Below the patterns used: \\
Model View Controller - MVC\\
MVC is a widely used pattern, particularly suitable for the development of applications written in object-oriented programming languages such as java. MVC is based on three main roles which are: the Model that contains all the methods to access the data useful to the application, the View that visualizes the data contained in the model and deals with the interaction with users and the Controller which receives the commands of the user and executes them them modifying the other two components. In CLup, the Model logic is in ..., the controller part .... Instead, the view is represented mainly by ...
\\
Adapter pattern\\
Adapter is a structural pattern that aims to match interfaces of different classes. The interface of the Adapter is interposed between the system and the Adaptee, that is the object to be adapted. In this way, whoever has to use a method of the Adaptee sees only an interface (or an abstract class) which would be implemented according to the component to be adapted. In the case of CLup, the component MapsServiceAdapter acts as the adapter, and GoogleMapsService is the component to be adapted. In this way, even assuming that the external service is changed, the internal system will not undergo any changes, since the new API will be handled by the MapsServiceAdapter component.\\
Facade pattern\\
Facade is also a structural pattern, which consists in a single class representing the entire subsystem. In the case of CLup, the Dispatcher takes all the requests from the client and then directs them to the specific component of the AppServer. The aim of this component is to mask the complexity of the entire subsystem, with which you can communicate via a simple interface.


\subsection {Other design decisions}
Thin/Fat client? DB?
